1. Cài đặt ansible
#cài trực tiếp:
yum -y install ansible
#cài trên docker
docker volume create ansible
docker volume create idrsa
docker run --rm -it -v ansible:/ansible -v idrsa:/root/id_rsa willhallonline/ansible:latest //bin//sh
docker exec -it musing_moser //bin//sh

2. Cấu hình Ansible
ssh-keygen
ssh-keygen -R $IP    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!
mv /etc/ansible/hosts /etc/ansible/hosts.org
vi /etc/ansible/hosts
vi /etc/ansible/ansible.cfg

3. Lấy thông tin máy client
hostname
hostname -I
cat /etc/*release

4. Nhập các thông tin cần thiết cho việc setup server
NAME=ubuntu2
IP=192.168.253.166
FILEDR=home         # thư mục chứa docker
ssh-copy-id root@$IP

5. Đăng ký client
printf $NAME' ansible_host='$IP' ansible_port=22 ansible_user=root\n' >> /etc/ansible/hosts
printf $NAME' ansible_host='$IP' ansible_port=2022 ansible_user=root\n' >> /etc/ansible/hosts
cat /etc/ansible/hosts

6. chạy playbook
ansible-playbook package.yml -e hname=$NAME
sed -i "s,FILEDR,$FILEDR," setup.yml
ansible-playbook setup.yml -e hname=$NAME
ansible-playbook parameters.yml -e hname=$NAME
ansible-playbook worker.yml -e "hname=centos7.1 token=SWMTKN-1-1xzabnpf3huupzn4dqsaosisz7jlrcaywi2slnyquqzsy5mn4j-563inpuxdhndpob86wqkdai2s ip=192.168.253.154:2377"

--tags all- chạy tất cả các tác vụ, bỏ qua các thẻ (hành vi mặc định)
--tags [tag1, tag2]- chỉ chạy các tác vụ có thẻ tag1hoặc thẻtag2
--skip-tags [tag3, tag4]- chạy tất cả các tác vụ ngoại trừ những tác vụ có thẻ tag3hoặc thẻtag4
--tags tagged- chỉ chạy các tác vụ với ít nhất một thẻ
--tags untagged- chỉ chạy các tác vụ không có thẻ

ansible-playbook example.yml --tags "configuration,packages"
ansible-playbook example.yml --skip-tags "packages"
ansible-playbook -vvv setup.yml xem thêm thông tin kết quả
